package ftprotocol

import (
	//	"bytes"
	"encoding/hex"
	"errors"
	"reflect"
	"testing"
)

func TestByteArray(t *testing.T) {
	cases := []struct {
		in   Frame
		want string
	}{
		{Frame{NoAck: true}, "00003030303000"},
		{Frame{Start: STX, End: ETX}, "060002003032303003"},
	}

	for _, c := range cases {
		//		c.in.NoAck = true
		output := c.in.ByteArray()

		got := hex.EncodeToString(output)

		if c.want != got {
			t.Errorf("ByteArray(),\nwant\t%s\ngot\t%s\n", c.want, got)
		}
	}
}

func TestParse(t *testing.T) {
	cases := []struct {
		in    string
		want1 string
		want2 string
		want3 error
	}{
		{"0630", "", "4646", nil},
		{"06", "", "", errors.New("invalid length")},
		{"06309", "", "", errors.New("invalid length")},
		{"0245353231323030202020202020202029524420202020202020203342202020202f4820202020262020202020202020202020314630370306300630", "06300630", "3132", nil},
		{"06300245353231323030202020202020202029524420202020202020203342202020202f48202020202620202020202020202020203146303703", "", "3132", nil},
		{"06300245353231323030202020202020202029524420202020202020203342202020202f482020202026202020202020202020202031463037030630", "0630", "3132", nil},
		{"0245353231323030202020202020202029524420202020202020203342202020202f4820202020262020202020202020202020314630370306300245353231323030202020202020202029524420202020202020203342202020202f482020202026202020202020202020202031463037030630", "06300245353231323030202020202020202029524420202020202020203342202020202f482020202026202020202020202020202031463037030630", "3132", nil},
		{"06300238353031323030202020202020202029524420202020202020203342202020202f482020202026202020202020202020202046373036030630", "0630", "3132", nil},
		{"0239303431453030202020203024394F3C462D4535272949383630402A25312D2A302020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202043363932030631", "0631", "3145", nil},
		{"063306340233353631453030202020203024394F3C462D4535272949383630402A25312D2A30202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020204342444303", "", "3145", nil},
		{"3039302D303343202020286E756C6C290D0A4D6F6E6F32205363616E6E6572202020202020", "", "", errors.New("unknown beginning of message.")},
		{"06380635024541323345303020202020392034374137030630", "0630", "3345", nil},
		{"0630023939323630303020202020203E5F4F5B5E5C2020202020305629535A34224020202020202020212F484A4A4B24205E335C3050423721592C5526483B33222A4A2C345D474B46202C2845503E3322343D294C5F402020382F5849225544292142483420202020204F5C442F5653562C222B54202020202020202020202020202020225F2F25332A4E5E3339282322293C273453343736392C284A48442358202F4E4050423721552C2845503D335E2020213C5F402020373044253B5C20202020202020202020202F385A284D502020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202032393843030631023939333630303020202020203E5F4F5B5E5C2020202020305629535A34224020202020202020212F4922423744205D5D2D5450423721592C55263F2D23222A4A2C545D4C465A262C2845503E3322294C32405F402020382F58205C4524292140412420202020202F5B5C4A3823562C222B54202020202020202020202020202020225F2F4B594F4F254F2E3E2322293C273453343F29592C284A492B535036584A2C50423721552C2845503D335E2020213C5F402020373044272E3950202020202020202020202F385A284D50202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203537304503", "0631023939333630303020202020203e5f4f5b5e5c2020202020305629535a34224020202020202020212f4922423744205d5d2d5450423721592c55263f2d23222a4a2c545d4c465a262c2845503e3322294c32405f402020382f58205c4524292140412420202020202f5b5c4a3823562c222b54202020202020202020202020202020225f2f4b594f4f254f2e3e2322293c273453343f29592c284a492b535036584a2c50423721552c2845503d335e2020213c5f402020373044272e3950202020202020202020202f385a284d50202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020202020203537304503", "3630", nil},
	}
	for _, c := range cases {
		var got Frame
		input, _ := hex.DecodeString(c.in)
		got1, got3 := got.Parse(input)
		got2 := hex.EncodeToString(got.MessageID)
		if got1 != c.want1 || got2 != c.want2 || !reflect.DeepEqual(got3, c.want3) {
			t.Errorf("Parse(),\nin\t%s\nwant\t|%s|\t%s\t%v\ngot\t|%s|\t%s\t%v\n", c.in, c.want1, c.want2, c.want3, got1, got2, got3)

		}

	}

}
